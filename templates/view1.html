{% extends "base.html" %}
{% block script %} 

<script>
    //////////////////////////
    
    $(document).ready(function () {
        $("#MarkingRadio").hide();
        $("#NameSearchRadio").hide();
        
        $("#SearchByNameDiv1").hide();
        $("#SearchByNameDiv2").hide();

        $("#SearchByNameForDirDiv1").hide();
        $("#SearchByNameForDirDiv2").hide();

        NameSearchRadioCheck=0

        var colorWay=['#e74c3c','#f1c40f', '#1abc9c', '#3498db' , '#9b59b6', '#e74c3c' , '#ff0000'];
        var colorCountForWay=0;
        var scale = 1;
        var originx = 0;
        var originy = 0;

        var zoomIntensity = 1.5;

        var admin_level=1;

        var maxLatConst = 28.9689998626709,
        maxLongConst = 77.73299407958984;

        var minLatConst = 28.18301010131836,
        minLongConst = 76.69200134277344;

        
        var maxLat = 28.9689998626709,
        maxLong = 77.73299407958984;

        var minLat = 28.18301010131836,
        minLong = 76.69200134277344;

        var c = document.getElementById("myCanvas");
        var width = c.width;
        var height = c.height;
        var ctx = c.getContext("2d");


        var visibleWidth = width;
        var visibleHeight = height;
        ////////////////////////////////////////////////////////////////
        function clear() {
            c = document.getElementById("myCanvas");
            ctx = c.getContext("2d");
            ctx.clearRect(0-100, 0-100, width+100, height+100);
        }

        ////////////////////////////////////////////////////////////////
        //<!-- This script is for mapping nodes on map(canvas) -->
        function draw(){
            clear();

            c = document.getElementById("myCanvas");
            ctx = c.getContext("2d");
            
            //var data = [];
            //var adjacency_list=[];
            var data = JSON.parse('{{list}}');
            var adjlist = JSON.parse('{{adjlist}}');
            var vi_adjids= JSON.parse('{{vi_adjids}}');
            var vi_adjgraphids= JSON.parse('{{vi_adjgraphids}}');

            console.log("obj=",  data[0], data[1]);
            console.log("obj=",  adjlist[0]);
            
            console.log("obj=",  data[2], data[3]);
            console.log("obj=",  adjlist[1]);
            
            console.log("obj=",  data[4], data[5]);
            console.log("obj=",  adjlist[2]);

            console.log("obj=",  data[6], data[7]);
            console.log("adj=",  adjlist);
            //console.log("vi_adjids=",  vi_adjids);
            // console.log("vi_adjgraphids=",  vi_adjgraphids);


            
            // // this is is from django
            // {% for i in list %}
            // var temp = '{{ i }}';
            // //console.log(temp); 
            
            // data.push( parseFloat(temp));
            // {% endfor %}

            // {% for i in adjlist %}
            // var temp = '{{ i }}';
            //     //console.log("adjacency_list",temp);
            //     adjacency_list.push( temp);


            //     // {% for j in temp %}
            //     //     var temp2 = '{{ j }}';
            //     //     console.log("adjacency_list",temp2);
                
            //     // {% endfor %}


            //     //adjacency_list.push( parseFloat(temp));
            // {% endfor %}

            // console.log("adjacency_list",adjacency_list);

            var count=-1;
            for (var i = 0; i < data.length-1; i+=2) {
            //for (var i = 0; i < 4;i+=2) {
                var lon1 = data[i];
                var lat1 = data[i+1];
                //console.log("node=", lon1, lat1);    
                


                var locX1 = ((lon1 - minLong) * (width) / (maxLong - minLong));
                var locY1 = ((maxLat - (lat1)) * (height) / (maxLat - minLat));

                // ctx.strokeStyle = "BLUE";
                // //console.log(lat, lon, locX1, locY1);
                
                // ctx.fillRect(locX1, locY1, 1, 1);
                // ctx.stroke();

                count++;
                //console.log("here");
                // for(var j=0; j<adjlist[count].length; j+=2){

                // }                   
                var count1=-1;    
                for (var j = 0; j<adjlist[count].length-1 ; j+=2) {
                //for (var j = 0; j < 1; j++) {
                    
                    count1++;
                    var lon2 = adjlist[count][j];
                    var lat2 = adjlist[count][j+1];
                    
                    //if(count==0 || count==1) 
                    //console.log("ad=", lon2, lat2);                   
                    
                    var locX2 = ((lon2 - minLong) * (width) / (maxLong - minLong));
                    var locY2 = ((maxLat - (lat2)) * (height) / (maxLat - minLat));
                    
                    var d=((locX2-locX1)*(locX2-locX1))+ ((locY2-locY1)*(locY2-locY1));
                    var dd=8980;
                    if(d>dd){
                        //vi_adjgraphids[count]
                        //console.log("locs=", lon2, lat2,  locX2,locY2, vi_adjids[count], vi_adjgraphids[count][count1])
                        continue;
                    }

                    // if(locX2<=0.0 || locY2<=0.0 || locX2>=1000.0 || locY2>=500.0)
                    //console.log("locs=", locX2,locY2)
                    ctx.strokeStyle = "RED";
                    ctx.beginPath();
                    ctx.moveTo(locX1,locY1);
                    ctx.lineTo(locX2,locY2);
                    ctx.lineWidth = 1;
                    ctx.stroke();
                    
                    
                    ctx.strokeStyle = "RED";
                    ctx.fillRect(locX2, locY2, 2, 2);
                    ctx.stroke();
                    
                }
            }
            ///////////////////////////////////////////////////////////
            
            // ctx.font = "30px Verdana";
            // var gradient = ctx.createLinearGradient(0, 0, c.width, 0);
            // gradient.addColorStop("0", "magenta");
            // gradient.addColorStop("0.5", "blue");
            // gradient.addColorStop("1.0", "red");

            // ctx.strokeStyle = gradient;
            // ctx.strokeText("Navigation On Delhi Map :)", 10, 50);
            
        }
        draw();
        //setInterval(draw,1000/60);


        ///////////////////////////////////////////////////
        
        ////////////////////////////////////////////////////////////////
        /////////////////Drag Drop./////////////////////////////
        

            // var img = new Image();
            // img.onload = function(){
            //     ctx.drawImage(img, 0,0);
            // };
            // img.src = "http://images.christmastimeclipart.com/images/2/1271716593176_1788/img_1271716593176_17881.jpg";

            var canvas=document.getElementById("myCanvas");
            var ctx=canvas.getContext("2d");
            var canvasOffset=$("#myCanvas").offset();
            var offsetX=canvasOffset.left;
            var offsetY=canvasOffset.top;
            var canvasWidth=canvas.width;
            var canvasHeight=canvas.height;
            var isDragging=false;
            var isMoving=false;
            var canMouseXinit;
            var canMouseYinit;
            var canMouseXfin;
            var canMouseYfin;
            var xdiff;
            var  x1, y1;
            var ydiff;
            
            function handleMouseDown(e){
              canMouseXinit=parseInt(e.clientX-offsetX);
              canMouseYinit=parseInt(e.clientY-offsetY);
              // set the drag flag
              isDragging=true;
            }

            function handleMouseUp(e){
              canMouseX=parseInt(e.clientX-offsetX);
              canMouseY=parseInt(e.clientY-offsetY);
              // clear the drag flag
              if(isDragging==true && isMoving==true  ){
                console.log("xdiff=",xdiff, "ydiff=", ydiff  );

                    // x1= ((xdiff*(Math.pow(2, admin_level))*(maxLongConst - minLongConst))/(width)) ;
                    // y1 = ((ydiff*(Math.pow(2, admin_level))*(maxLatConst - minLatConst))/(height))  * (-1);

                    x1= ((xdiff*(Math.pow(2, 0))*(maxLong - minLong))/(width)) ;
                    y1 = ((ydiff*(Math.pow(2, 0))*(maxLat - minLat))/(height))  * (-1);

                    
                  minLong-=x1;
                  maxLong-=x1;
                  minLat-=y1;
                  maxLat-=y1;

                console.log("admin_level", admin_level , "locX1=",x1 , "locY1=", y1 , "lat long min max",  minLat, minLong, maxLat, maxLong  );
                rtreeAjax(admin_level, minLat, minLong, maxLat, maxLong);
              }
              isDragging=false;
              isMoving=false;
            }

            function handleMouseOut(e){
              canMouseX=parseInt(e.clientX-offsetX);
              canMouseY=parseInt(e.clientY-offsetY);
              // user has left the canvas, so clear the drag flag
              //isDragging=false;
            }

            function handleMouseMove(e){
                //console.log("locs move",maxLat, maxLong,minLat,minLong   );
                

                
                if(isDragging){
                  isMoving=true;
                    
                  canMouseXfin=parseInt(e.clientX-offsetX);
                  canMouseYfin=parseInt(e.clientY-offsetY);

                  xdiff=canMouseXfin-canMouseXinit;
                  ydiff=canMouseYfin-canMouseYinit;
                  
                  console.log("before diff",xdiff,ydiff);

                  //console.log("diff",xdiff,ydiff, "lat long min max",  minLat, minLong, maxLat, maxLong  );


                  
                  // if the drag flag is set, clear the canvas and draw the image
                  
                      // ctx.clearRect(0,0,canvasWidth,canvasHeight);
                      // clear();

                  //rtreeAjax(admin_level, minLat, minLong, maxLat, maxLong);
                  //ctx.drawImage(img,canMouseX-128/2,canMouseY-120/2,128,120);
                }
            }

            $("#myCanvas").mousedown(function(e){handleMouseDown(e);});
            $("#myCanvas").mouseup(function(e){handleMouseUp(e);});
            $("#myCanvas").mousemove(function(e){handleMouseMove(e);});
            $("#myCanvas").mouseout(function(e){handleMouseOut(e);});

        

        ////////////////////////////////////////////////////////////////
        /////////////////Zoom in Zoom Out./////////////////////////////
        function rtreeAjax(admin_level, minLat, minLon, maxLat, maxLon){

            console.log("here");
            var request = $.ajax({
                url: "/app1/rtree",
                type: "POST",
                data: { admin_level:admin_level, minLat: minLat, minLon:minLon, maxLat:maxLat, maxLon:maxLon} ,            
                dataType: "html"
            });

            request.done(function(msg) {
                clear();
                
                obj = JSON.parse(msg);
                //console.log(obj);
                var data= obj.list;
                var adjlist = obj.adjlist;
                console.log("data= ",data,  "len=", data.length);
                console.log("adjlist= ",adjlist);

                var count=-1;
                for (var i = 0; i < data.length-1; i+=2) {
                    count++;


                    //for (var i = 0; i < 4;i+=2) {
                    var lon1 = data[i];
                    var lat1 = data[i+1];
                    //console.log("node=", lon1, lat1);    
                    


                    var locX1 = ((lon1 - minLong) * (width) / (maxLong - minLong));
                    var locY1 = ((maxLat - (lat1)) * (height) / (maxLat - minLat));

                    ctx.strokeStyle = "BLUE";
                    //console.log(lat, lon, locX1, locY1);
                    
                    ctx.fillRect(locX1, locY1, 2, 2);
                    ctx.stroke();
                }

                // var data = JSON.parse('{{list}}');
                // var adjlist = JSON.parse('{{adjlist}}');

                // ids=obj.id;//array
                // names=obj.name;//array

                // console.log("response= ",ids);
                
            });

            request.fail(function(jqXHR, textStatus) {
                alert( "Request failed: " + textStatus );
            });
        }

        $("#OUT").on("click", function(){
            console.log('out');
            if(admin_level==1){
                alert("Cant be further Zoomed Out");
            }
            else{
                console.log("loccss:= ", minLat, minLong,maxLat,maxLong );
                minLat=minLat-(maxLat-minLat)*(0.20000000000000000);
                minLong=minLong-(maxLong-minLong)*(0.20000000000000000);
                
                maxLat=maxLat+(maxLat-minLat)*(0.20000000000000000);
                maxLong=maxLong+(maxLong-minLong)*(0.20000000000000000);

                admin_level-=1;
                //admin_level=1;
                console.log("loccss:= ", minLat, minLong,maxLat,maxLong );
                rtreeAjax(admin_level, minLat, minLong, maxLat, maxLong);


            }

        });
        
        $("#IN").on("click", function(){
            console.log('in');
            if(admin_level==10){
                alert("Cant be further Zoomed In");
            }
            else{
                console.log("loccss:= ", minLat, minLong,maxLat,maxLong );
                minLat=minLat+(maxLat-minLat)*(0.20000000000000000);
                minLong=minLong+(maxLong-minLong)*(0.20000000000000000);
                
                maxLat=maxLat-(maxLat-minLat)*(0.20000000000000000);
                maxLong=maxLong-(maxLong-minLong)*(0.20000000000000000);

                admin_level+=1;
                //admin_level=1;
                console.log("loccss:= ", minLat, minLong,maxLat,maxLong );
                rtreeAjax(admin_level, minLat, minLong, maxLat, maxLong);


            }
        });

        function displayAstar(list){
             console.log("list=",list);
            //clear();
            for (var i=0; i < list.length-2; i+=2) {
                    var lat1 = list[i+1];
                    var lon1= list[i];
                    var lat2 = list[i+3];
                    var lon2= list[i+2];
                    //console.log("here",lon1, lat1, lon2, lat2 );
                    
                    

                    var locX1 = ((lon1 - minLong) * (width) / (maxLong - minLong));
                    var locY1 = ((maxLat - (lat1)) * (height) / (maxLat - minLat));
                    var locX2 = ((lon2 - minLong) * (width) / (maxLong - minLong));
                    var locY2 = ((maxLat - (lat2)) * (height) / (maxLat - minLat));
                    //console.log("here",locX1, locY1, locX2, locY2 );

                    ctx.strokeStyle = "RED";
                    ctx.beginPath();
                    ctx.moveTo(locX1,locY1);
                    ctx.lineTo(locX2,locY2);
                    ctx.lineWidth = 1;
                    ctx.stroke();
            }
           
            
            
        }

        //////////////////////////////////////////////////////////////////
        displayAstar
        ///////////////// Marker on Map ////////////////////////////////
        var PointChooseFlag=0;

        // astar by point pick  type 1 
        function astarAjax( Lon1,Lat1, Lon2, Lat2){

            console.log("here");
            var request = $.ajax({
                url: "/app1/astar",
                type: "POST",
                data: { type:1, Lat1: Lat1,Lon1:Lon1,Lat2:Lat2,Lon2:Lon2} ,            
                dataType: "html"
            });

            request.done(function(msg) {
                obj = JSON.parse(msg);
                var list= obj.list;
                displayAstar(list)
                

               
                
            });

            request.fail(function(jqXHR, textStatus) {
                alert( "Request failed: " + textStatus );
            });
        }

        function mark(img, event, height, width){
            //console.log("here1,PointChooseFlag", PointChooseFlag);

            // var x = Math.round(event.offsetX - width/2);
            // var y = Math.round(event.offsetY - height/2);

            var x = Math.round(event.offsetX-3);
            var y = Math.round(event.offsetY -height -2);

            ctx.drawImage(img,x,y, height, width);
            PointChooseFlag+=1;
        }

        // $("#hide").click(function(){
        //     $("#SearchByNameDiv1").hide();
        //     $("#SearchByNameDiv2").hide();
        // });

        // $("#show").click(function(){
        //     $("p").show();
        // });
        
        $("#SearchByName").on("click", function(){
            $("#SearchByNameDiv1").show();
            $("#SearchByNameDiv2").show();
            
            // document.getElementById('MarkingRadio').checked = false;
            // document.getElementById('NameSearchRadio').checked = false;

            $("#MarkingRadio").hide();
            $("#NameSearchRadio").hide();
            $("#SearchByNameForDirDiv1").hide();
            $("#SearchByNameForDirDiv2").hide();
            
             
        });
        

        $("#MarkingRadio").on("click", function(){
            NameSearchRadioCheck=0;
            $("#SearchByNameForDirDiv1").hide();
            $("#SearchByNameForDirDiv2").hide();

            PointChooseFlag=0;
            var x1, x2, y1, y2;
            {% load static %}
            // console.log("static=", '{% static "img/marker.png" %}');
            
            

            var img1 = new Image();
            img1.src ='{% static "img/src.png" %}';
            
            var img2 = new Image();
            img2.src = '{% static "img/dst.png" %}';
            c.onclick = function(event){

                var rect = c.getBoundingClientRect();
                    //     var x =event.clientX - rect.left;
                    //     var y = event.clientY - rect.top;
                    //     // console.log("x=", x, "y=", y);

                    if(PointChooseFlag%2==0){
                     x1 =event.clientX - rect.left;
                     y1 = event.clientY - rect.top;
                     mark(img1, event, 30, 30);
                     
                     
                 }
                 else{
                    x2 =event.clientX - rect.left;
                    y2 = event.clientY - rect.top;
                    mark(img2, event, 30 , 30 );
                    console.log("clicked locs=", x1,y1,x2, y2);
                    
                    //x1 = ((lon1 - minLong) * (width) / (maxLong - minLong));
                    x1 = ((x1*(maxLong - minLong))/(width)) +  minLong;

                    //y1 = ((maxLat - (lat1)) * (height) / (maxLat - minLat));
                    y1 = (((y1*(maxLat - minLat))/(height)) -  maxLat) * (-1);

                    //x2 = ((lon2 - minLong) * (width) / (maxLong - minLong));
                    x2 = ((x2*(maxLong - minLong))/(width)) +  minLong;

                    //y2 = ((maxLat - (lat2)) * (height) / (maxLat - minLat));
                    y2 = (((y2*(maxLat - minLat))/(height)) -  maxLat) * (-1);

                    console.log("clicked long lats=", x1,y1,x2, y2);
                    
                    astarAjax(x1, y1, x2, y2);

                }

            };

        });

        $("#NameSearchRadio").on("click", function(){
            NameSearchRadioCheck=1;
            $("#SearchByNameForDirDiv1").show();
            $("#SearchByNameForDirDiv2").show();
            

        });


        $("#SrcDst").on("click", function(){
            $("#MarkingRadio").show();
            $("#NameSearchRadio").show();

            $("#SearchByNameDiv1").hide();
            $("#SearchByNameDiv2").hide();


            if(NameSearchRadioCheck==1) {
                //console.log("checked radio");
                $("#SearchByNameForDirDiv1").show();
                $("#SearchByNameForDirDiv2").show();

            }
            else{
                //console.log("unchecked radio");
                $("#SearchByNameForDirDiv1").hide();
                $("#SearchByNameForDirDiv2").hide();
            } 

        });

        

        
        
        //////////////////////////////////////////////////////////////



        var rect = c.getBoundingClientRect();
        
        var left1=rect.left + width; 
        var top1=rect.top ;
        console.log("left1=", left1.toString());
        console.log("top1=", top1.toString());

        

        document.getElementById("IN").style.top = (top1).toString()+"px";
        document.getElementById("IN").style.left = (left1+10).toString()+"px";

        document.getElementById("OUT").style.top =  (top1+35).toString()+"px";
        document.getElementById("OUT").style.left = (left1+10).toString()+"px";

        document.getElementById("SearchByName").style.top =  (top1+70).toString()+"px";
        document.getElementById("SearchByName").style.left = (left1+10).toString()+"px";

        document.getElementById("SrcDst").style.top =  (top1+105).toString()+"px";
        document.getElementById("SrcDst").style.left = (left1+10).toString()+"px";

        // document.getElementById("Directions").style.top =  (top1+140).toString()+"px";
        // document.getElementById("Directions").style.left = (left1+10).toString()+"px";
        
        // MarkingRadio
        // NameSearchRadio
        document.getElementById("MarkingRadio").style.top =  (top1+140).toString()+"px";
        document.getElementById("MarkingRadio").style.left = (left1+20).toString()+"px";

        document.getElementById("NameSearchRadio").style.top =  (top1+170).toString()+"px";
        document.getElementById("NameSearchRadio").style.left = (left1+10).toString()+"px";
        
        

        ///////////////////////////////////////////////////////////////

        function displayNodes(data, img1){
            clear();
            
            //console.log("nodes inside inside, data=", data);
            
            for (var i = 0; i < data.length; i+=2) {
                var lon = data[i+1];
                var lat = data[i];
                var locX1 = ((lon - minLong) * (width) / (maxLong - minLong));
                var locY1 = ((maxLat - (lat)) * (height) / (maxLat - minLat));

                //console.log(lat, lon, locX1, locY1);
                var x = Math.round(locX1- 30/2);
                var y = Math.round(locY1 - 30);

                ctx.drawImage(img1,x,y, 30, 30);
            }
        }

        function displayWays(list, dlist){
            //clear();
            c = document.getElementById("myCanvas");
            ctx = c.getContext("2d");

            var color=['#6f1984', '#e74c3c','#e80633', '#f1c40f', '#3498db' ,'#6f0b01',  '#4ef442','#9b59b6','#414ff4', '#e74c3c' , '#1abc9c', '#ff0000',];
            
            //console.log("list=", list, "dlist=", dlist)
            
            //count=0;
            if(dlist.length!=1){
                for (var i=0; i < dlist.length-1; i++) {
                  

                    var lon1 = list[2*i+1];
                    var lat1 = list[2*i];
                    var lon2 = list[2*i+3];
                    var lat2 = list[2*i+2];
                    console.log("here",lon1, lat1, lon2, lat2 );
                    
                    

                    var locX1 = ((lon1 - minLong) * (width) / (maxLong - minLong));
                    var locY1 = ((maxLat - (lat1)) * (height) / (maxLat - minLat));
                    var locX2 = ((lon2 - minLong) * (width) / (maxLong - minLong));
                    var locY2 = ((maxLat - (lat2)) * (height) / (maxLat - minLat));
                    //console.log("here",locX1, locY1, locX2, locY2 );

                    //ctx.strokeStyle = "RED";
                    ctx.beginPath();
                    ctx.moveTo(locX1,locY1);
                    ctx.lineTo(locX2,locY2);
                    ctx.lineWidth = 1;
                    
                    ctx.strokeStyle = colorWay[colorCountForWay];
                    ctx.stroke();

                    // ctx.fillRect(locX1, locY1, 1, 1);
                    // ctx.stroke();

                    // ctx.fillRect(locX2, locY2, 1, 1);
                    // ctx.stroke();

                    if(dlist[i+1]==1){
                        //break;
                        i+=1;
                        
                        colorCountForWay+=1;
                        if(colorCountForWay == colorWay.length){
                            colorCountForWay=0;
                        }

                    }
                    
                }
            }                

            colorCountForWay+=1;
            if(colorCountForWay == colorWay.length){
                colorCountForWay=0;
            }
        }


        
        
        $("body").on("click", ".list-group-item", function(){

            var parent=$(this).parent();
            var type = parent.attr("id");
            var name= this.id;

            var id= $(this).attr("name");
            console.log("list node/way id=", id);

            //console.log('id of clicked item= ', this.id, "name of selected item=", parent.attr("id"));
            if(type=="nodes" || type=="ways"){
                
                document.getElementsByName('search_name')[0].value=name;
                var img1 = new Image();
                img1.src ='{% static "img/pin.png" %}';

                var request = $.ajax({
                    url: "/app1/data",
                    type: "POST",
                    data: { name: name, type:type } ,            
                    dataType: "html"
                });

                request.done(function(msg) {
                    obj = JSON.parse(msg);
                    //console.log("obj= ",obj);
                    
                    var way_list=obj.way_list;
                    var dlist=obj.dlist;
                    var node_list=obj.node_list;
                    //longs=obj.long;
                    
                    //list= [28.492847442626953, 77.00435638427734, 28.434986114501953, 77.05077362060547, 28.619922637939453, 77.07022094726562, 28.503517150878906, 77.20549774169922, 28.758880615234375, 77.1546401977539, 28.47164535522461, 77.49659729003906, 28.49455451965332, 77.28811645507812, 28.67414093017578, 77.44739532470703, 28.60383415222168, 77.24569702148438, 28.431650161743164, 77.00296783447266, 28.322860717773438, 77.32283782958984];

                    if(type=="nodes"){
                        console.log("nodes inside");
                       displayNodes(node_list, img1); 
                    }
                    else if(type=="ways"){
                        console.log("ways inside");
                        displayWays(way_list, dlist);    
                    }
                    
                });

                request.fail(function(jqXHR, textStatus) {
                    alert( "Request failed: " + textStatus );
                });

            }
            else if(type=="2"){
                document.getElementsByName('search_name_src')[0].value=name;
                document.getElementsByName('search_name_src_id')[0].value=id;

            }
            else if(type=="3"){
                document.getElementsByName('search_name_dst')[0].value=name;
                document.getElementsByName('search_name_dst_id')[0].value=id;
            }
            
        });

    });


        ////////////////////////////////

    function listing(way_names, way_ids,node_names, node_ids, type) {

        var div = $('<div/>');
        if(type==1){

            var h1 = $('<h4>Ways:</h4>');
            if(way_names.length!=0){
                div.append(h1);
                var ul1 = $('<ul class="list-group" id="ways"  />').appendTo(div);
                for(var i=0 ;i<way_names.length; i++){
                    var li = $('<li class="list-group-item" />').appendTo(ul1);
                    li.attr("id", way_names[i]);
                    li.attr("name", way_ids[i]);
                    var t =way_names[i];
                    li.append(t);
                }
            }


            

            var h2 = $('<h4>Nodes:</h4>');
            if(node_names.length!=0){
                div.append(h2);
                var ul2 = $('<ul class="list-group" id="nodes"  />').appendTo(div);

                for(var i=0 ;i<node_names.length; i++){
                    var li = $('<li class="list-group-item" />').appendTo(ul2);
                    li.attr("id", node_names[i]);
                    li.attr("name", node_ids[i]);
                    var t =node_names[i];
                    li.append(t);
                }
            }

        }
        else if(type==2 || type==3){
            var h2 = $('<h4>Nodes:</h4>');
            if(node_names.length!=0){
                div.append(h2);
                var ul2;
                if(type==2){
                    ul2 = $('<ul class="list-group" id="2"  />').appendTo(div);
                    //node_ids

                }
                else if (type==3){
                    ul2 = $('<ul class="list-group" id="3"  />').appendTo(div);
                    //node_ids
                }
               
                for(var i=0 ;i<node_names.length; i++){
                    var li = $('<li class="list-group-item" />').appendTo(ul2);
                    li.attr("id", node_names[i]);
                    li.attr("name", node_ids[i]);
                    var t =node_names[i];
                    li.append(t);
                }
            }

        }
        
        return div;
    }

    ///////////////////////////

    function myCall(name, type) {
        console.log("here", "type in my call=", type);
        var request = $.ajax({
            url: "/app1/list",
            type: "POST",
            data: { search: name, type: type } ,            
            dataType: "html"
        });

        request.done(function(msg) {
            obj = JSON.parse(msg);
            way_ids=obj.way_ids;
            way_names=obj.way_names;
            
            node_ids=obj.node_ids;
            node_names=obj.node_names;


            console.log("response= ",way_ids);
            console.log("response= ",way_names);
            console.log("response= ",node_ids);
            console.log("response= ",node_names);
            //$("#mybox").html(msg);

            if(type==1){
                $('.listing1').html(listing(way_names, way_ids,node_names, node_ids, type));
            }
            else if(type==2 || type==3){
                $('.listing2').html(listing(way_names, way_ids,node_names, node_ids, type));
            }

        });

        request.fail(function(jqXHR, textStatus) {
            alert( "Request failed: " + textStatus );
        });
    }
    
    // astar by name search  type 2 
    function getDirections(srcId, dstId) {
        console.log('GetDirections, ids=', srcId, dstId);
        var request = $.ajax({
            url: "/app1/astar",
            type: "POST",
            data: { type:2, srcId:srcId,  dstId:dstId } ,            
            dataType: "html"
        });

        request.done(function(msg) {
            obj = JSON.parse(msg);
            var list= obj.list;
            displayAstar(list)
            //console.log("from astar type 2:", obj)
            displayAstar(list)

            
        });

        request.fail(function(jqXHR, textStatus) {
            alert( "Request failed: " + textStatus );
        });
    }



    //////////////////////
</script>

<meta charset="utf-8" />
<title>MinorProject</title>

<style type="text/css">
    /*#mybox {
        width: 300px;
        height: 200px;
        border: 1px solid #999;
    }*/
    .list-group-item {
        cursor: pointer
    }
    .listing1 div ul {
        max-height: 200px;
        overflow-y:scroll;
    }
    .listing2 div ul {
        max-height: 200px;
        overflow-y:scroll;
    }
</style>

{% endblock %} 


{% block main %}
{% load static %}
<div>
    <canvas id="myCanvas" width="1000" height="500"  style="z-index:1; border:1px solid red;">
    </canvas>

    <button id="IN" type="button" class="btn btn-default btn-sm" style="z-index:2; position:absolute; ">
      <span class="glyphicon glyphicon-zoom-in"></span> Zoom-In
  </button>

  <button id="OUT" type="button" class="btn btn-default btn-sm" style="z-index:2; position:absolute; ">
      <span class="glyphicon glyphicon-zoom-out"></span> Zoom-Out
  </button>

  <button id="SearchByName" type="button" class="btn btn-default btn-sm" style="z-index:2; position:absolute; ">
     <span class="glyphicon glyphicon-search"></span> Search By Name
  </button>

  <button id="SrcDst" type="button" class="btn btn-default btn-sm" style="z-index:2; position:absolute; ">
      <span class="glyphicon glyphicon-screenshot"></span> Select SRC and DST
  </button>

  <!-- <button id="Directions" type="button" class="btn btn-default btn-sm" style="z-index:2; position:absolute; ">
      <span class="glyphicon glyphicon-road"></span> Get-Directions
  </button>
 -->

 <!-- <form> -->
    <label id="MarkingRadio" class="radio-inline" style="z-index:2; position:absolute;">
      <input type="radio" name="optradio">Marking Point On Map
    </label>

    <label id="NameSearchRadio" class="radio-inline" style="z-index:2; position:absolute;">
      <input type="radio" name="optradio">Searching By Name
    </label>

    
  <!-- </form> -->





</div>    



<div id="SearchByNameDiv1"class="form-group">
    <div class="col-lg-4">
        <!-- <input type="text" class="form-control" placeholder=".col-lg-2"> -->
        <br>
        <label for="inputdefault">Search By Name:</label>

        <input type="text" name="search_name" class="form-control" value="">
        <br>

        <button type="button"  onclick="myCall(document.getElementsByName('search_name')[0].value, 1)" class="btn btn-default" value="Search" />
            <span class="glyphicon glyphicon-search"></span> Search
        </button>


    <br><br>
    </div>

</div>
<div id="SearchByNameDiv2"class="col-lg-4">

    
    <div class="listing1"> 
    </div>

    <!-- <div id="mybox">
    </div> -->

</div>



<div id="SearchByNameForDirDiv1"class="form-group">
    <div class="col-lg-4">
        <!-- <input type="text" class="form-control" placeholder=".col-lg-2"> -->
        <br>
        <label for="inputdefault">Search For SRC By Name:</label>

        <input type="text" name="search_name_src" class="form-control" value="">
        <input type="hidden" name="search_name_src_id" value="">
        
        <button type="button"  onclick="myCall(document.getElementsByName('search_name_src')[0].value, 2)" class="btn btn-default" value="Search" />
            <span class="glyphicon glyphicon-search"></span> Search
        </button>

        <br><br>

        <label for="inputdefault">Search For DST By Name:</label>

        <input type="text" name="search_name_dst" class="form-control" value="">
        <input type="hidden" name="search_name_dst_id" value="">
        <button type="button"  onclick="myCall(document.getElementsByName('search_name_dst')[0].value, 3)" class="btn btn-default" value="Search" />
            <span class="glyphicon glyphicon-search"></span> Search
        </button>

        <br><br>
        
        <button id="Directions" type="button"  onclick="getDirections(document.getElementsByName('search_name_src_id')[0].value, document.getElementsByName('search_name_dst_id')[0].value)" class="btn btn-default btn-sm" >
            <span class="glyphicon glyphicon-road"></span> Get-Directions
        </button>
       
       

        <!-- <button type="button"  onclick="myCall(document.getElementsByName('search_name')[0].value)" class="btn btn-default" value="Search" />
            <span class="glyphicon glyphicon-search"></span> Search
        </button> -->


    <br><br>
    </div>

</div>
<div id="SearchByNameForDirDiv2"class="col-lg-4">

    
    <div class="listing2"  > 
    </div>

    <!-- <div id="mybox">
    </div> -->

</div>

    <!-- <img src="{% static "img/marker.png" %}" alt="My image"/>
-->
                <!-- <img src="{% static "img/src.png" %}" alt="My image"/>
                
                <img src="{% static "img/dst.png" %}" alt="My image"/> -->

{% endblock %}